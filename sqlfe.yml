routes:
  /users:
    query: >
      insert into "user"
      (name, email, password)
      values (${body.user.username}, ${body.user.email}, ${body.user.password})
      returning
        name as "user.username",
        email as "user.email",
        image as "user.image",
        bio as "user.bio",
        email as "user.token"
    arity: 1
  /users/login:
    query: >
      select
        name as "user.username",
        email as "user.email",
        image as "user.image",
        bio as "user.bio",
        email as "user.token"
      from "user"
      where
        email = ${body.user.email}
        and password = ${body.user.password}
    arity: 1
  /user:
    query: >
      select
        name as "user.username",
        email as "user.email",
        image as "user.image",
        bio as "user.bio",
        email as "user.token"
      from "user"
      where
        email = substring(${headers.authorization} from 7)
    arity: 1
  /articles:
    query: >
      select * from "/articles"(
        {{#headers.authorization}}substring(${headers.authorization} from 7),{{/headers.authorization}}
        {{^headers.authorization}}null,{{/headers.authorization}}
        {{#query.author}}${query.author},{{/query.author}}
        {{^query.author}}null,{{/query.author}}
        {{#query.favorited}}${query.favorited},{{/query.favorited}}
        {{^query.favorited}}null,{{/query.favorited}}
        {{#query.offset}}${query.offset},{{/query.offset}}
        {{^query.offset}}null,{{/query.offset}}
        {{#query.limit}}${query.limit}{{/query.limit}}
        {{^query.limit}}null{{/query.limit}}
      )
  /articles/feed:
    query: >
      select * from "/articles"(
        {{#headers.authorization}}substring(${headers.authorization} from 7),{{/headers.authorization}}
        {{^headers.authorization}}null,{{/headers.authorization}}
        {{#query.author}}${query.author},{{/query.author}}
        {{^query.author}}null,{{/query.author}}
        {{#query.favorited}}${query.favorited},{{/query.favorited}}
        {{^query.favorited}}null,{{/query.favorited}}
        {{#query.offset}}${query.offset},{{/query.offset}}
        {{^query.offset}}null,{{/query.offset}}
        {{#query.limit}}${query.limit}{{/query.limit}}
        {{^query.limit}}null{{/query.limit}}
      )
